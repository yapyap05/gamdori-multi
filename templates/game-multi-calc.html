<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🎮️ Gamdori</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/template_style.css">
</head>

<body class="py-4">
  <div class="wrap px-3">
    <div class="d-flex flex-wrap align-items-end justify-content-between gap-2 mb-3">
      <div>
        <h1 class="h3 mb-1 neon-title"><span class="text-white-50">계산x계산해 🎮️</span></h1>
        <div class="text-white-50 small">
          <span class="mono">누구 보다 빨리 사칙연산을 풀어보세요</span>
        </div>
      </div>

      <div class="d-flex flex-wrap gap-2">
        <button id="btnStart" class="btn btn-neon">시작</button>
        <!-- <button id="btnRestartStage" class="btn btn-outline-light">현재 단계 재시작</button> -->
        <button id="btnRestartAll" class="btn btn-neon2">처음부터</button>
        <button id="btnGotoIndex" class="btn btn-neon3">🏠</button>
      </div>
    </div>

    <div class="row g-3">
      <!-- Left: Machine -->
      <div class="col-12 col-lg-7">
        <div class="card glass machine border-0">
          <div class="card-body">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
              <div class="d-flex flex-wrap gap-2">
                <span class="chip"><span class="badge badge-soft">Stage</span> <span id="hudStage" class="mono fw-bold">-</span></span>
                <span class="chip"><span class="badge badge-soft">Rule</span> <span id="hudRule" class="mono fw-bold">-</span></span>
                <span class="chip"><span class="badge badge-soft">Need</span> <span id="hudNeed" class="mono fw-bold">-</span></span>
                <span class="chip"><span class="badge badge-soft">Remain</span> <span id="hudRemain" class="mono fw-bold">-</span></span>
              </div>

              <div class="d-flex align-items-center gap-2">
                <div class="timer-ring" id="timerRing" style="--p:0%;">
                  <div class="mono" id="timerText">-</div>
                </div>
                <div>
                  <div class="text-white-50 small">시간 제한</div>
                  <div class="mono fw-bold"><span id="hudTimeLimit">-</span>s</div>
                </div>
              </div>
            </div>

            <div class="progress mb-3" style="height: 10px; background: rgba(255,255,255,.10);">
              <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width:0%"></div>
            </div>

            <!-- Slot Reels -->
            <div class="p-3 rounded-4" style="background: rgba(0,0,0,.20); border: 1px solid rgba(255,255,255,.10);">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <div class="text-white-50 small">SLOT</div>
                <div class="d-flex flex-wrap gap-2">
                  <span class="chip"><span class="badge badge-soft">Streak</span> <span id="hudStreak" class="mono fw-bold">0</span></span>
                  <span class="chip"><span class="badge badge-soft">Score</span> <span id="hudScore" class="mono fw-bold">0</span></span>
                </div>
              </div>

              <div class="reels mb-3">
                <div class="reel" id="reelA">
                  <div class="stack" id="stackA"></div>
                  <div class="window mono" id="windowA">-</div>
                </div>

                <div class="op mono" id="opSymbol">?</div>

                <div class="reel" id="reelB">
                  <div class="stack" id="stackB"></div>
                  <div class="window mono" id="windowB">-</div>
                </div>
              </div>

              <div class="d-flex justify-content-center mb-2">
                <div class="question-line mono text-center" id="questionLine">시작을 눌러주세요</div>
              </div>

              <div class="text-center">
                <span id="spinBadge" class="badge text-bg-secondary mono d-none blink">SPINNING...</span>
              </div>
            </div>

            <form id="answerForm" class="row g-2 align-items-center mt-3">
              <div class="col-12 col-md-8">
                <input id="answerInput" class="form-control form-control-lg mono" type="number" inputmode="numeric" placeholder="정답 입력" disabled />
              </div>
              <div class="col-12 col-md-4 d-grid">
                <button id="btnSubmit" class="btn btn-success btn-lg" type="submit" disabled>제출</button>
              </div>
            </form>
            <div class="p-2 form-text text-white-50">Enter로 제출 / Esc로 처음부터</div>
          </div>
        </div>
      </div>

      <!-- Right: Controls + Log -->
      <div class="col-12 col-lg-5">
        <div class="card glass border-0 mb-3">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between gap-2 mb-2">
              <div class="fw-bold">레벨 선택</div>
              <!-- <span class="text-white-50 small">선택 후 시작</span> -->
            </div>

            <div class="row g-2 align-items-end">
              <div class="col-7">
                <label class="form-label text-white-50 mb-1">시작 단계</label>
                <select id="stageSelect" class="form-select">
                  <option value="1">1단계 (덧셈) · 대기3초 · 5회</option>
                  <option value="2" disabled>2단계 (뺄셈) · 대기3초 · 5회</option>
                  <option value="3" disabled>3단계 (나눗셈-몫) · 대기5초 · 3회</option>
                  <option value="4" disabled>4단계 (곱셈) · 대기5초 · 3회</option>
                </select>
              </div>
              <div class="col-5">
                <label class="form-label text-white-50 mb-1">사운드</label>
                <select id="soundSelect" class="form-select">
                  <option value="on" selected>ON</option>
                  <option value="off">OFF</option>
                </select>
              </div>
            </div>

            <hr style="border-color: rgba(255,255,255,.12);" />

            <div class="d-flex flex-wrap gap-2">
              <span class="chip"><span class="badge badge-soft">정답</span> <span id="hudCorrect" class="mono fw-bold">0</span></span>
              <span class="chip"><span class="badge badge-soft">오답</span> <span id="hudWrong" class="mono fw-bold">0</span></span>
              <span class="chip"><span class="badge badge-soft">타임아웃</span> <span id="hudTimeout" class="mono fw-bold">0</span></span>
              <span class="chip"><span class="badge badge-soft">총 시도</span> <span id="hudAttempt" class="mono fw-bold">0</span></span>
            </div>

            <div class="mt-3 small text-white-50">
              <div class="fw-semibold text-white mb-1">단계 규칙</div>
              <ul class="mb-0">
                <li>1: 덧셈 / 3초 대기 / 5회 정답</li>
                <li>2: 뺄셈(음수 방지) / 3초 대기 / 5회 정답</li>
                <li>3: 나눗셈(몫) / 5초 대기 / 3회 정답 (나누어떨어짐)</li>
                <li>4: 곱셈 / 5초 대기 / 3회 정답</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="card glass border-0">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between gap-2 mb-2">
              <div class="fw-bold">문제/정답 로그</div>
              <div class="d-flex gap-2">
                <button id="btnDownloadCsv" class="btn btn-outline-light btn-sm">CSV</button>
                <button id="btnClearLog" class="btn btn-outline-danger btn-sm">비우기</button>
              </div>
            </div>

            <div class="table-responsive" style="max-height: 360px;">
              <table class="table table-sm table-darkish align-middle mb-0">
                <thead style="position: sticky; top: 0; background: rgba(10,15,35,.95);">
                  <tr>
                    <th class="text-white-50">#</th>
                    <th class="text-white-50">Stage</th>
                    <th class="text-white-50">문제</th>
                    <th class="text-white-50">입력</th>
                    <th class="text-white-50">정답</th>
                    <th class="text-white-50">결과</th>
                    <th class="text-white-50">남은시간</th>
                  </tr>
                </thead>
                <tbody id="logBody">
                  <tr><td colspan="7" class="text-white-50">아직 기록이 없습니다.</td></tr>
                </tbody>
              </table>
            </div>

            <div class="text-white-50 small mt-2">
              팁: <span class="mono">Enter</span>로 제출, <span class="mono">Esc</span>로 처음부터 리셋
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
      <div id="toast" class="toast align-items-center text-bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div id="toastBody" class="toast-body">-</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../script/script-multi.js"></script>
</body>
</html>
